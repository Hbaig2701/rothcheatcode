---
phase: 09-pdf-export
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - lib/pdf/components/pdf-header.tsx
  - lib/pdf/components/pdf-footer.tsx
  - lib/pdf/components/pdf-summary.tsx
  - lib/pdf/components/pdf-chart-image.tsx
  - lib/pdf/components/pdf-strategy-table.tsx
  - lib/pdf/components/pdf-year-table.tsx
  - lib/pdf/components/pdf-document.tsx
  - lib/pdf/index.ts
autonomous: true

must_haves:
  truths:
    - "PDFDocument renders without errors"
    - "PDFHeader shows client name and generation date"
    - "PDFFooter shows disclaimer and page numbers on every page"
    - "PDFSummary displays key metrics in a readable format"
    - "PDFStrategyTable shows 4-strategy comparison with best highlighted"
    - "PDFYearTable shows year-by-year data with proper column alignment"
  artifacts:
    - path: "lib/pdf/components/pdf-document.tsx"
      provides: "Main PDF document structure with 3 pages"
      min_lines: 80
    - path: "lib/pdf/components/pdf-header.tsx"
      provides: "Report header with title and metadata"
      min_lines: 25
    - path: "lib/pdf/components/pdf-footer.tsx"
      provides: "Fixed footer with disclaimer and page numbers"
      min_lines: 30
    - path: "lib/pdf/components/pdf-summary.tsx"
      provides: "Summary metrics section"
      min_lines: 40
    - path: "lib/pdf/components/pdf-strategy-table.tsx"
      provides: "4-strategy comparison table"
      min_lines: 80
    - path: "lib/pdf/components/pdf-year-table.tsx"
      provides: "Year-by-year projection table"
      min_lines: 60
    - path: "lib/pdf/components/pdf-chart-image.tsx"
      provides: "Chart image wrapper component"
      min_lines: 15
    - path: "lib/pdf/index.ts"
      provides: "Barrel export for PDF components"
      exports: ["PDFDocument"]
  key_links:
    - from: "lib/pdf/components/pdf-document.tsx"
      to: "lib/pdf/styles.ts"
      via: "StyleSheet import"
      pattern: "import.*styles.*from.*styles"
    - from: "lib/pdf/components/pdf-strategy-table.tsx"
      to: "lib/calculations/strategy-definitions.ts"
      via: "STRATEGY_DEFINITIONS import"
      pattern: "import.*STRATEGY_DEFINITIONS"
---

<objective>
Create all PDF component building blocks that compose the final report.

Purpose: Build reusable react-pdf components for each section of the report - header, footer, summary, charts, and tables.
Output: Complete set of PDF components ready for assembly in the API route.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-pdf-export/09-RESEARCH.md
@.planning/phases/09-pdf-export/09-01-SUMMARY.md

# Types from previous plan
@lib/pdf/types.ts
@lib/pdf/styles.ts

# Existing project types and definitions
@lib/calculations/types.ts
@lib/calculations/strategy-definitions.ts
@lib/types/projection.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PDF atomic components (Header, Footer, ChartImage)</name>
  <files>
    lib/pdf/components/pdf-header.tsx
    lib/pdf/components/pdf-footer.tsx
    lib/pdf/components/pdf-chart-image.tsx
  </files>
  <action>
    1. Create lib/pdf/components/pdf-header.tsx:
       - Import View, Text, StyleSheet from '@react-pdf/renderer'
       - Props: clientName: string, generatedAt: string
       - Render title "Roth Conversion Analysis Report"
       - Render client name prominently
       - Render "Generated: {date}" in muted text
       - Add horizontal line separator (View with borderBottom)
       - Use local styles or import from styles.ts

    2. Create lib/pdf/components/pdf-footer.tsx:
       - Import View, Text from '@react-pdf/renderer'
       - Use `fixed` prop on outer View for fixed positioning on every page
       - Render disclaimer text (from research): "This report is for informational purposes only and does not constitute financial, tax, or legal advice. Consult a qualified professional before making any financial decisions."
       - Render page numbers using render prop: `render={({ pageNumber, totalPages }) => \`Page ${pageNumber} of ${totalPages}\`}`
       - Position at bottom 30px from page edge

    3. Create lib/pdf/components/pdf-chart-image.tsx:
       - Import View, Text, Image from '@react-pdf/renderer'
       - Props: src: string | null, title: string
       - If src is null/empty, render a placeholder "Chart not available"
       - If src exists, render Image with src={src} and object-fit contain
       - Add title above the image
  </action>
  <verify>
    - TypeScript compiles without errors
    - Components export correctly
    - Footer uses fixed prop for multi-page footer
  </verify>
  <done>Header, Footer, and ChartImage atomic components created</done>
</task>

<task type="auto">
  <name>Task 2: Create PDF Summary and Table components</name>
  <files>
    lib/pdf/components/pdf-summary.tsx
    lib/pdf/components/pdf-strategy-table.tsx
    lib/pdf/components/pdf-year-table.tsx
  </files>
  <action>
    1. Create lib/pdf/components/pdf-summary.tsx:
       - Import View, Text from '@react-pdf/renderer'
       - Props: metrics: SummaryMetrics (from types.ts)
       - Helper function formatCurrency(cents: number): string using Intl.NumberFormat
       - Render in a 2-column layout:
         * Left column: Ending Wealth (Blueprint), Tax Savings, Breakeven Age
         * Right column: IRMAA Surcharges, Heir Benefit
       - Use positive color for positive values, negative for negative
       - Handle null breakEvenAge gracefully (show "N/A")

    2. Create lib/pdf/components/pdf-strategy-table.tsx:
       - Import Table, TR, TH, TD from '@ag-media/react-pdf-table'
       - Import View, Text, StyleSheet from '@react-pdf/renderer'
       - Import STRATEGY_DEFINITIONS, STRATEGIES from '@/lib/calculations/strategy-definitions'
       - Props: result: MultiStrategyResult
       - Use weightings array for column widths: [0.24, 0.19, 0.19, 0.19, 0.19]
       - Header row: Metric | Conservative | Moderate | Aggressive | IRMAA-Safe
       - Mark bestStrategy column with "BEST" label and blue highlight
       - Rows: Ending Wealth, Tax Savings, Breakeven Age, IRMAA Surcharges, Heir Benefit
       - Use formatCurrency for monetary values
       - Green text for positive savings/benefits

    3. Create lib/pdf/components/pdf-year-table.tsx:
       - Import Table, TR, TH, TD from '@ag-media/react-pdf-table'
       - Import View, Text from '@react-pdf/renderer'
       - Props: years: YearlyResult[], title: string (for "Baseline" or "Blueprint")
       - IMPORTANT: Show summarized years (every 5 years + final year) to fit on page
       - Column weightings: [0.08, 0.08, 0.14, 0.14, 0.14, 0.14, 0.14, 0.14]
       - Columns: Year, Age, Traditional, Roth, Taxable, Conversion, Tax, Net Worth
       - Format all currency values using formatCurrency
       - Highlight conversion years (conversionAmount > 0) with light blue background
  </action>
  <verify>
    - TypeScript compiles without errors
    - Tables render with proper column widths
    - formatCurrency handles cents-to-dollars conversion
  </verify>
  <done>Summary and table components created with proper formatting</done>
</task>

<task type="auto">
  <name>Task 3: Create PDFDocument and barrel export</name>
  <files>
    lib/pdf/components/pdf-document.tsx
    lib/pdf/index.ts
  </files>
  <action>
    1. Create lib/pdf/components/pdf-document.tsx:
       - Import Document, Page, View, Text from '@react-pdf/renderer'
       - Import all component files (PDFHeader, PDFFooter, PDFSummary, PDFChartImage, PDFStrategyTable, PDFYearTable)
       - Import styles from '../styles'
       - Import types from '../types'
       - Props: PDFDocumentProps

       Document structure (3 pages):

       **Page 1: Executive Summary (Portrait)**
       - PDFHeader
       - "Executive Summary" section title
       - PDFSummary with key metrics
       - Wealth chart image (if provided)
       - PDFFooter (fixed)

       **Page 2: Strategy Comparison (Portrait)**
       - "Strategy Comparison" section title
       - PDFStrategyTable
       - Breakeven chart image (if provided)
       - PDFFooter (fixed)

       **Page 3: Year-by-Year Projection (Landscape)**
       - "Year-by-Year Projection" section title
       - PDFYearTable for Blueprint scenario (key milestones)
       - PDFFooter (fixed)

       Add Document metadata:
       - title: `Roth Conversion Analysis - ${clientName}`
       - author: 'Rothc'
       - subject: 'Roth Conversion Strategy Report'

    2. Create lib/pdf/index.ts:
       - Export PDFDocument as named export
       - Export types from './types'
       - Export styles from './styles' (for potential customization)
  </action>
  <verify>
    - TypeScript compiles without errors
    - `import { PDFDocument } from '@/lib/pdf'` works
    - PDFDocument accepts all required props
  </verify>
  <done>Complete PDFDocument structure assembled with all components</done>
</task>

</tasks>

<verification>
- `npm run build` succeeds
- All PDF components are importable from lib/pdf/
- PDFDocument has correct 3-page structure
- Strategy table shows all 4 strategies with best highlighted
- Year table shows summarized milestone years
- Footer appears on every page with disclaimer
</verification>

<success_criteria>
- 7 PDF components created (Header, Footer, Summary, ChartImage, StrategyTable, YearTable, Document)
- PDFDocument exports from lib/pdf/index.ts
- Components use shared styles from lib/pdf/styles.ts
- Currency formatting consistent (cents to dollars)
- Table column widths defined with weightings
</success_criteria>

<output>
After completion, create `.planning/phases/09-pdf-export/09-02-SUMMARY.md`
</output>

---
phase: 09-pdf-export
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - next.config.ts
  - lib/pdf/types.ts
  - lib/pdf/styles.ts
autonomous: true

must_haves:
  truths:
    - "@react-pdf/renderer is installed and importable"
    - "@ag-media/react-pdf-table is installed and importable"
    - "html-to-image is installed and importable"
    - "Next.js config has serverExternalPackages for react-pdf"
  artifacts:
    - path: "lib/pdf/types.ts"
      provides: "PDF document types (props, data shapes)"
      min_lines: 30
    - path: "lib/pdf/styles.ts"
      provides: "StyleSheet definitions for PDF components"
      min_lines: 50
  key_links:
    - from: "next.config.ts"
      to: "@react-pdf/renderer"
      via: "serverExternalPackages array"
      pattern: "serverExternalPackages.*@react-pdf/renderer"
---

<objective>
Install PDF generation libraries and create type/style foundation for PDF components.

Purpose: Establish the technical foundation for PDF generation - libraries configured and core types/styles defined.
Output: Working library imports, Next.js config, PDF types, and reusable StyleSheet.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-pdf-export/09-RESEARCH.md

# Existing types to reference
@lib/types/projection.ts
@lib/calculations/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install PDF libraries and configure Next.js</name>
  <files>
    package.json
    package-lock.json
    next.config.ts
  </files>
  <action>
    1. Install required libraries:
       ```bash
       npm install @react-pdf/renderer @ag-media/react-pdf-table html-to-image
       ```

    2. Update next.config.ts to add serverExternalPackages:
       ```typescript
       import type { NextConfig } from "next";

       const nextConfig: NextConfig = {
         serverExternalPackages: ['@react-pdf/renderer'],
       };

       export default nextConfig;
       ```

    This is REQUIRED because @react-pdf/renderer has issues with Next.js App Router bundling without this config.
  </action>
  <verify>
    - `npm ls @react-pdf/renderer` shows package installed
    - `npm ls @ag-media/react-pdf-table` shows package installed
    - `npm ls html-to-image` shows package installed
    - next.config.ts contains serverExternalPackages array
  </verify>
  <done>Libraries installed, Next.js configured for server-side react-pdf usage</done>
</task>

<task type="auto">
  <name>Task 2: Create PDF types and styles</name>
  <files>
    lib/pdf/types.ts
    lib/pdf/styles.ts
  </files>
  <action>
    1. Create lib/pdf/types.ts with:
       - PDFDocumentProps interface (clientName, generatedAt, data, chartImages)
       - PDFDataProps interface (projection data shape for PDF)
       - ChartImages interface (wealth, breakeven, sensitivity - all optional base64 strings)
       - SummaryMetrics interface (endingWealth, taxSavings, breakEvenAge, totalIRMAA, heirBenefit)
       - Import YearlyResult from calculations types
       - Import StrategyComparisonMetrics and MultiStrategyResult for strategy table

    2. Create lib/pdf/styles.ts with StyleSheet.create():
       - page: padding 40, paddingBottom 80 (footer space), fontSize 10, fontFamily 'Helvetica'
       - section: marginBottom 15
       - title: fontSize 14, fontWeight 'bold', marginBottom 10
       - subtitle: fontSize 11, fontWeight 'bold', marginBottom 8
       - text: fontSize 9, lineHeight 1.4
       - textMuted: fontSize 8, color '#666666'
       - chartImage: width '100%', height 200, objectFit 'contain'
       - footer: position 'absolute', bottom 30, left 40, right 40
       - disclaimer: fontSize 7, color '#666666', textAlign 'center', marginBottom 5
       - pageNumber: fontSize 8, textAlign 'center', color '#999999'
       - row: flexDirection 'row', marginBottom 4
       - label: fontSize 9, fontWeight 'bold', width 120
       - value: fontSize 9
       - positive: color '#16a34a' (green-600)
       - negative: color '#dc2626' (red-600)
       - headerCell: backgroundColor '#f3f4f6', padding 6, fontSize 8, fontWeight 'bold'
       - cell: padding 6, fontSize 8, textAlign 'center'
       - bestCell: backgroundColor '#eff6ff' (blue-50)
       - bestHeader: backgroundColor '#dbeafe' (blue-100)
       - metricLabel: textAlign 'left', fontWeight 'bold'
  </action>
  <verify>
    - TypeScript compiles without errors
    - Types import correctly: `import { PDFDocumentProps } from '@/lib/pdf/types'`
    - Styles import correctly: `import { styles } from '@/lib/pdf/styles'`
  </verify>
  <done>PDF type definitions and StyleSheet ready for component use</done>
</task>

</tasks>

<verification>
- `npm run build` succeeds (no TypeScript errors)
- Libraries properly installed in node_modules
- next.config.ts has serverExternalPackages config
- lib/pdf/types.ts exports all required interfaces
- lib/pdf/styles.ts exports StyleSheet with all required styles
</verification>

<success_criteria>
- All 3 libraries installed and listed in package.json dependencies
- next.config.ts includes serverExternalPackages: ['@react-pdf/renderer']
- PDFDocumentProps, ChartImages, SummaryMetrics types defined
- StyleSheet with page, section, table, footer styles ready
</success_criteria>

<output>
After completion, create `.planning/phases/09-pdf-export/09-01-SUMMARY.md`
</output>

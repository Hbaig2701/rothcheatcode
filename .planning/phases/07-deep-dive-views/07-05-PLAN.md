---
phase: 07-deep-dive-views
plan: 05
type: execute
wave: 3
depends_on: [07-04]
files_modified:
  - app/(dashboard)/clients/[id]/results/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can navigate to client results page and see tabbed deep-dive interface"
    - "Results page fetches projection data and renders DeepDiveTabs"
    - "All 4 tabs function correctly with real client data"
  artifacts:
    - path: "app/(dashboard)/clients/[id]/results/page.tsx"
      provides: "Results page route with DeepDiveTabs integration"
      min_lines: 30
  key_links:
    - from: "app/(dashboard)/clients/[id]/results/page.tsx"
      to: "components/results"
      via: "DeepDiveTabs import"
      pattern: "import.*DeepDiveTabs.*from.*@/components/results"
    - from: "app/(dashboard)/clients/[id]/results/page.tsx"
      to: "lib/queries/projections"
      via: "useProjection hook"
      pattern: "import.*useProjection.*from.*@/lib/queries"
---

<objective>
Create the results page route and wire DeepDiveTabs to display real projection data for a client.

Purpose: Complete the user journey by integrating all deep-dive components into a functional results page that advisors can access from the client detail view.

Output: Working results page at `/clients/[id]/results` showing the tabbed deep-dive interface with actual projection data.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@rothc/.planning/PROJECT.md
@rothc/.planning/ROADMAP.md
@rothc/.planning/STATE.md
@rothc/.planning/phases/07-deep-dive-views/07-RESEARCH.md
@rothc/.planning/phases/07-deep-dive-views/07-04-SUMMARY.md

# Key existing files
@rothc/app/(dashboard)/clients/[id]/page.tsx
@rothc/lib/queries/projections.ts
@rothc/lib/queries/clients.ts
@rothc/components/results/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create results page route</name>
  <files>app/(dashboard)/clients/[id]/results/page.tsx</files>
  <action>
Create `app/(dashboard)/clients/[id]/results/page.tsx`:

1. Add 'use client' directive (required for query hooks)

2. Import dependencies:
   - `useParams` from `next/navigation`
   - `useClient` from `@/lib/queries/clients`
   - `useProjection` from `@/lib/queries/projections`
   - `DeepDiveTabs` from `@/components/results`
   - Skeleton from `@/components/ui/skeleton`
   - Link from `next/link`
   - ArrowLeft from `lucide-react`
   - Button from `@/components/ui/button`

3. Create ResultsPage component:

```typescript
export default function ResultsPage() {
  const params = useParams();
  const clientId = params.id as string;

  // Fetch client and projection data
  const { data: client, isLoading: clientLoading, error: clientError } = useClient(clientId);
  const { data: projectionResponse, isLoading: projectionLoading, error: projectionError } = useProjection(clientId);

  // Loading state
  if (clientLoading || projectionLoading) {
    return (
      <div className="space-y-6">
        <Skeleton className="h-8 w-64" />
        <Skeleton className="h-[400px]" />
        <Skeleton className="h-[600px]" />
      </div>
    );
  }

  // Error state
  if (clientError || projectionError) {
    return (
      <div className="text-center py-12">
        <p className="text-destructive">
          Error loading results: {clientError?.message || projectionError?.message}
        </p>
        <Button asChild variant="outline" className="mt-4">
          <Link href={`/clients/${clientId}`}>Back to Client</Link>
        </Button>
      </div>
    );
  }

  // No data state
  if (!client || !projectionResponse?.projection) {
    return (
      <div className="text-center py-12">
        <p className="text-muted-foreground">No projection data available</p>
        <Button asChild variant="outline" className="mt-4">
          <Link href={`/clients/${clientId}`}>Back to Client</Link>
        </Button>
      </div>
    );
  }

  const { projection } = projectionResponse;

  return (
    <div className="space-y-6">
      {/* Header with back navigation */}
      <div className="flex items-center gap-4">
        <Button asChild variant="ghost" size="icon">
          <Link href={`/clients/${clientId}`}>
            <ArrowLeft className="h-5 w-5" />
          </Link>
        </Button>
        <div>
          <h1 className="text-2xl font-bold">{client.name} - Results</h1>
          <p className="text-muted-foreground">
            {projection.strategy} Strategy | {projection.projection_years} Year Projection
          </p>
        </div>
      </div>

      {/* Deep Dive Tabs */}
      <DeepDiveTabs projection={projection} client={client} />
    </div>
  );
}
```

4. Key implementation notes:
   - Uses params.id to get client ID from URL
   - Fetches both client (for metadata) and projection (for data)
   - Shows loading skeletons while data fetches
   - Handles error and empty states gracefully
   - Provides back navigation to client detail page
   - Passes projection and client to DeepDiveTabs

5. Ensure the directory structure exists: `app/(dashboard)/clients/[id]/results/`
  </action>
  <verify>
- File exists at `app/(dashboard)/clients/[id]/results/page.tsx`
- TypeScript compiles: `npm run build`
- Route accessible at `/clients/{id}/results`
  </verify>
  <done>Results page route created with loading states, error handling, and DeepDiveTabs integration</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete deep-dive views with tabbed interface:
- Year-by-year data tables with sticky headers (Baseline and Blueprint tabs)
- IRMAA bar chart with threshold reference lines
- NIIT calculation display
- 5-year Roth seasoning tracker
- Conversion schedule summary
- URL-synced tabs for shareability
  </what-built>
  <how-to-verify>
1. Deploy to Vercel (push changes)
2. Navigate to https://rothc-lime.vercel.app
3. Log in and select a client with projection data
4. Navigate to results page: `/clients/{id}/results`
5. Verify all 4 tabs work:
   - **Summary tab:** Shows summary cards and wealth chart
   - **Baseline tab:** Shows year-by-year table with sticky header (scroll down to test)
   - **Blueprint tab:** Shows year-by-year table with conversion years highlighted
   - **Schedule tab:** Shows IRMAA chart, NIIT display, seasoning tracker, and schedule summary
6. Test URL sync:
   - Click Blueprint tab, verify URL shows `?tab=blueprint`
   - Copy URL and open in new tab, verify Blueprint tab is selected
   - Use back button, verify returns to previous tab
7. Test sticky header:
   - In Baseline or Blueprint tab, scroll down through years
   - Verify column headers stay visible at top
  </how-to-verify>
  <resume-signal>Type "approved" if all tabs work correctly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` passes with no TypeScript errors
2. Results page loads at `/clients/{id}/results`
3. All 4 tabs render correct content
4. URL updates when switching tabs
5. Direct URL access with tab parameter works
6. Sticky headers function in year-by-year tables
</verification>

<success_criteria>
- Results page accessible at `/clients/{id}/results`
- Loading states show while fetching data
- Error states display helpful messages
- DeepDiveTabs renders with all 4 functional tabs
- Year-by-year tables show 12 columns of projection data
- Sticky headers work when scrolling
- IRMAA chart shows threshold lines
- NIIT display shows threshold and affected years
- Roth seasoning tracker shows cohort statuses
- Schedule summary shows conversion totals
- URL sync enables sharing specific tab views
</success_criteria>

<output>
After completion, create `.planning/phases/07-deep-dive-views/07-05-SUMMARY.md`
</output>

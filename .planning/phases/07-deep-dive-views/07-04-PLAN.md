---
phase: 07-deep-dive-views
plan: 04
type: execute
wave: 2
depends_on: [07-01, 07-02, 07-03]
files_modified:
  - components/results/deep-dive/deep-dive-tabs.tsx
  - components/results/deep-dive/index.ts
  - components/results/index.ts
autonomous: true

must_haves:
  truths:
    - "User can navigate between Summary, Baseline, Blueprint, and Schedule tabs"
    - "Tab state persists in URL for shareability and back-button support"
    - "Baseline tab shows year-by-year data for no-conversion scenario"
    - "Blueprint tab shows year-by-year data with conversions highlighted"
    - "Schedule tab shows IRMAA chart, NIIT display, Roth seasoning tracker, and conversion summary"
  artifacts:
    - path: "components/results/deep-dive/deep-dive-tabs.tsx"
      provides: "Main tabbed container for deep-dive views"
      exports: ["DeepDiveTabs"]
    - path: "components/results/index.ts"
      provides: "Updated barrel exports including deep-dive components"
      contains: "DeepDiveTabs"
  key_links:
    - from: "components/results/deep-dive/deep-dive-tabs.tsx"
      to: "components/ui/tabs"
      via: "Tabs component import"
      pattern: "import.*Tabs.*from.*@/components/ui/tabs"
    - from: "components/results/deep-dive/deep-dive-tabs.tsx"
      to: "next/navigation"
      via: "URL state management"
      pattern: "useSearchParams|useRouter|usePathname"
---

<objective>
Create the main DeepDiveTabs container that integrates all deep-dive components into a cohesive tabbed interface with URL-synced tab state.

Purpose: Provide the complete deep-dive experience that allows advisors to explore detailed year-by-year data, IRMAA visualization, and conversion schedule. URL sync enables sharing specific tabs.

Output: DeepDiveTabs component with 4 tabs: Summary, Baseline, Blueprint, Schedule. All components from 07-01/02/03 integrated.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@rothc/.planning/PROJECT.md
@rothc/.planning/ROADMAP.md
@rothc/.planning/STATE.md
@rothc/.planning/phases/07-deep-dive-views/07-RESEARCH.md
@rothc/.planning/phases/07-deep-dive-views/07-01-SUMMARY.md
@rothc/.planning/phases/07-deep-dive-views/07-02-SUMMARY.md
@rothc/.planning/phases/07-deep-dive-views/07-03-SUMMARY.md

# Key existing files
@rothc/lib/types/projection.ts
@rothc/lib/types/client.ts
@rothc/components/ui/tabs.tsx
@rothc/components/results/deep-dive/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DeepDiveTabs container component</name>
  <files>components/results/deep-dive/deep-dive-tabs.tsx</files>
  <action>
Create `components/results/deep-dive/deep-dive-tabs.tsx`:

1. Add 'use client' directive at top (required for hooks)

2. Import dependencies:
   - `useSearchParams, useRouter, usePathname` from `next/navigation`
   - `useCallback` from `react`
   - `Tabs, TabsContent, TabsList, TabsTrigger` from `@/components/ui/tabs`
   - `Projection` from `@/lib/types/projection`
   - `Client` from `@/lib/types/client`
   - All deep-dive components:
     - `YearByYearTable` from `./year-by-year-table`
     - `IRMAAChart` from `./irmaa-chart`
     - `NIITDisplay` from `./niit-display`
     - `RothSeasoningTracker` from `./roth-seasoning-tracker`
     - `ScheduleSummary` from `./schedule-summary`
   - Summary components from parent:
     - `SummarySection` from `../summary-section`

3. Define tab configuration:
```typescript
type TabValue = 'summary' | 'baseline' | 'blueprint' | 'schedule';

const TABS: { value: TabValue; label: string }[] = [
  { value: 'summary', label: 'Summary' },
  { value: 'baseline', label: 'Baseline' },
  { value: 'blueprint', label: 'Blueprint' },
  { value: 'schedule', label: 'Schedule' },
];
```

4. Create DeepDiveTabs component:
   - Props: `projection: Projection`, `client: Client`
   - Use hooks for URL-synced tab state:
```typescript
const router = useRouter();
const pathname = usePathname();
const searchParams = useSearchParams();

const currentTab = (searchParams.get('tab') as TabValue) || 'summary';

const handleTabChange = useCallback((value: string) => {
  const params = new URLSearchParams(searchParams);
  params.set('tab', value);
  router.push(`${pathname}?${params.toString()}`, { scroll: false });
}, [router, pathname, searchParams]);
```

5. Calculate derived values for components:
   - `currentYear = new Date().getFullYear()`
   - `clientAge` from client.date_of_birth calculation
   - `filingStatus = client.filing_status`

6. Render Tabs with:
   - `value={currentTab}` and `onValueChange={handleTabChange}`
   - TabsList with grid layout: `grid-cols-4` for 4 equal columns
   - TabsTrigger for each tab

7. Render TabsContent for each tab:

**Summary tab:**
   - Render existing SummarySection with projection data
   - This reuses the summary cards and wealth chart from Phase 05

**Baseline tab:**
   - YearByYearTable with `years={projection.baseline_years}` and `scenario="baseline"`

**Blueprint tab:**
   - YearByYearTable with `years={projection.blueprint_years}` and `scenario="blueprint"`

**Schedule tab:**
   - Grid layout (responsive: 1 col on mobile, 2 cols on lg)
   - Left column:
     - IRMAAChart with `years={projection.blueprint_years}` and `filingStatus`
   - Right column:
     - NIITDisplay with `years={projection.blueprint_years}` and `filingStatus`
     - RothSeasoningTracker with `blueprintYears`, `currentYear`, `clientAge`
     - ScheduleSummary with `blueprintYears`

8. Export component.

Key implementation details:
- URL sync uses searchParams instead of useState for tab state
- scroll: false prevents page jump on tab change
- Client age calculation: `new Date().getFullYear() - new Date(client.date_of_birth).getFullYear()`
- Use space-y-6 between components in Schedule tab columns
  </action>
  <verify>
- File exists at `components/results/deep-dive/deep-dive-tabs.tsx`
- TypeScript compiles: `npm run build`
- Component exports DeepDiveTabs
  </verify>
  <done>DeepDiveTabs provides URL-synced tabbed interface with Summary, Baseline, Blueprint, and Schedule tabs, integrating all deep-dive components</done>
</task>

<task type="auto">
  <name>Task 2: Update barrel exports for deep-dive and results</name>
  <files>
    components/results/deep-dive/index.ts
    components/results/index.ts
  </files>
  <action>
1. Update `components/results/deep-dive/index.ts`:

```typescript
// Deep Dive Views (Phase 07)
export { YearByYearTable } from './year-by-year-table';
export { IRMAAChart } from './irmaa-chart';
export { NIITDisplay } from './niit-display';
export { RothSeasoningTracker } from './roth-seasoning-tracker';
export { ScheduleSummary } from './schedule-summary';
export { DeepDiveTabs } from './deep-dive-tabs';
```

2. Update `components/results/index.ts` to include deep-dive exports:

```typescript
// Results Summary (Phase 05)
export { StatCard } from './stat-card';
export { ChartTooltip } from './chart-tooltip';
export { WealthChart } from './wealth-chart';
export { SummarySection } from './summary-section';

// Strategy Comparison (Phase 06)
export { BestBadge, StrategyComparisonTable } from './strategy-comparison';

// Deep Dive Views (Phase 07)
export {
  YearByYearTable,
  IRMAAChart,
  NIITDisplay,
  RothSeasoningTracker,
  ScheduleSummary,
  DeepDiveTabs,
} from './deep-dive';
```

This enables clean imports from `@/components/results` for all result visualization components.
  </action>
  <verify>
- `npm run build` passes
- DeepDiveTabs exported from both barrel files
- All deep-dive components accessible via `@/components/results`
  </verify>
  <done>Barrel exports updated to include all Phase 07 components, enabling clean imports from @/components/results</done>
</task>

</tasks>

<verification>
1. `npm run build` passes with no TypeScript errors
2. DeepDiveTabs renders with 4 tabs
3. Tab selection updates URL query parameter
4. Back button restores previous tab
5. Each tab content renders appropriate components
6. All components accessible via `@/components/results`
</verification>

<success_criteria>
- 4 tabs visible: Summary, Baseline, Blueprint, Schedule
- Clicking tab updates URL with `?tab=baseline` etc.
- Direct URL access `?tab=schedule` opens Schedule tab
- Back button returns to previous tab
- Summary tab shows SummarySection with charts/cards
- Baseline tab shows year-by-year table for no-conversion scenario
- Blueprint tab shows year-by-year table with conversion highlighting
- Schedule tab shows IRMAA chart, NIIT display, seasoning tracker, and schedule summary in grid layout
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-deep-dive-views/07-04-SUMMARY.md`
</output>

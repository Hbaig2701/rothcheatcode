---
phase: 06-multi-strategy-comparison
plan: 02
type: execute
wave: 2
depends_on: [06-01]
files_modified:
  - components/results/strategy-comparison/best-badge.tsx
  - components/results/strategy-comparison/strategy-comparison-table.tsx
  - components/results/strategy-comparison/index.ts
  - components/results/index.ts
autonomous: true

must_haves:
  truths:
    - "Best strategy column is visually highlighted in comparison table"
    - "BEST badge shows star icon with green background"
    - "Table displays 5 comparison metrics for all 4 strategies"
    - "View Details buttons allow strategy selection"
  artifacts:
    - path: "components/results/strategy-comparison/best-badge.tsx"
      provides: "BEST recommendation badge with star icon"
      min_lines: 10
    - path: "components/results/strategy-comparison/strategy-comparison-table.tsx"
      provides: "4-column comparison table with highlighting"
      min_lines: 80
    - path: "components/results/strategy-comparison/index.ts"
      provides: "Barrel export for strategy comparison components"
      exports: ["BestBadge", "StrategyComparisonTable"]
  key_links:
    - from: "components/results/strategy-comparison/strategy-comparison-table.tsx"
      to: "lib/calculations/strategy-definitions.ts"
      via: "import STRATEGY_DEFINITIONS"
      pattern: "import.*STRATEGY_DEFINITIONS"
    - from: "components/results/strategy-comparison/strategy-comparison-table.tsx"
      to: "components/results/strategy-comparison/best-badge.tsx"
      via: "import BestBadge"
      pattern: "import.*BestBadge"
    - from: "components/results/index.ts"
      to: "components/results/strategy-comparison/index.ts"
      via: "export from strategy-comparison"
      pattern: "export.*from.*strategy-comparison"
---

<objective>
Create the strategy comparison UI components.

Purpose: Display all 4 strategies side-by-side in a comparison table with the best strategy visually highlighted. Users can see key metrics at a glance and select a strategy for detailed view.
Output: StrategyComparisonTable component with BestBadge, styled with conditional highlighting, and View Details buttons.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-multi-strategy-comparison/06-RESEARCH.md
@.planning/phases/06-multi-strategy-comparison/06-01-SUMMARY.md

@lib/calculations/types.ts
@lib/calculations/strategy-definitions.ts
@components/ui/table.tsx
@components/ui/badge.tsx
@components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BestBadge component</name>
  <files>components/results/strategy-comparison/best-badge.tsx</files>
  <action>
Create directory and file `components/results/strategy-comparison/best-badge.tsx`:

```typescript
import { Star } from 'lucide-react';
import { Badge } from '@/components/ui/badge';

/**
 * Visual badge indicating the recommended strategy
 * Displayed in the comparison table header for the best strategy
 */
export function BestBadge() {
  return (
    <Badge
      variant="default"
      className="gap-1 bg-green-600 hover:bg-green-600 text-white"
    >
      <Star className="h-3 w-3 fill-current" />
      <span>BEST</span>
    </Badge>
  );
}
```

Key implementation notes:
- Uses lucide-react Star icon (already in project)
- Uses shadcn/ui Badge component
- Green-600 background for positive association (green = good)
- fill-current on Star icon fills the star solid
- hover:bg-green-600 prevents color change on hover (maintains prominence)
  </action>
  <verify>
Run `npx tsc --noEmit` - should compile.
Check file exists: `ls components/results/strategy-comparison/best-badge.tsx`
  </verify>
  <done>
BestBadge component created. Displays green "BEST" badge with filled star icon.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create StrategyComparisonTable component</name>
  <files>components/results/strategy-comparison/strategy-comparison-table.tsx</files>
  <action>
Create `components/results/strategy-comparison/strategy-comparison-table.tsx`:

```typescript
'use client';

import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import { Button } from '@/components/ui/button';
import { BestBadge } from './best-badge';
import {
  MultiStrategyResult,
  StrategyType
} from '@/lib/calculations/types';
import {
  STRATEGY_DEFINITIONS,
  STRATEGIES
} from '@/lib/calculations/strategy-definitions';
import { cn } from '@/lib/utils';

interface StrategyComparisonTableProps {
  result: MultiStrategyResult;
  selectedStrategy?: StrategyType;
  onStrategySelect?: (strategy: StrategyType) => void;
}

/**
 * Format cents as currency string
 */
function formatCurrency(cents: number): string {
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
    minimumFractionDigits: 0,
    maximumFractionDigits: 0,
  }).format(cents / 100);
}

/**
 * Format a positive number with + prefix for tax savings
 */
function formatSavings(cents: number): string {
  if (cents <= 0) return '$0';
  return '+' + formatCurrency(cents);
}

/**
 * 4-column comparison table showing all strategies side-by-side
 * Best strategy column is highlighted with primary/10 background
 */
export function StrategyComparisonTable({
  result,
  selectedStrategy,
  onStrategySelect
}: StrategyComparisonTableProps) {
  const { bestStrategy, comparisonMetrics } = result;

  return (
    <div className="rounded-lg border bg-card overflow-hidden">
      {/* Horizontal scroll container for mobile */}
      <div className="overflow-x-auto">
        <Table className="min-w-[700px]">
          <TableHeader>
            <TableRow>
              <TableHead className="w-[180px] font-semibold">Metric</TableHead>
              {STRATEGIES.map(strategy => (
                <TableHead
                  key={strategy}
                  className={cn(
                    'text-center min-w-[130px]',
                    strategy === bestStrategy && 'bg-primary/10'
                  )}
                >
                  <div className="flex flex-col items-center gap-1 py-1">
                    <span className="font-semibold">
                      {STRATEGY_DEFINITIONS[strategy].name}
                    </span>
                    <span className="text-xs text-muted-foreground font-normal">
                      {STRATEGY_DEFINITIONS[strategy].description}
                    </span>
                    {strategy === bestStrategy && <BestBadge />}
                  </div>
                </TableHead>
              ))}
            </TableRow>
          </TableHeader>
          <TableBody>
            {/* Ending Wealth Row */}
            <TableRow>
              <TableCell className="font-medium">Ending Wealth</TableCell>
              {STRATEGIES.map(strategy => (
                <TableCell
                  key={strategy}
                  className={cn(
                    'text-center font-mono text-sm',
                    strategy === bestStrategy && 'bg-primary/10 font-semibold'
                  )}
                >
                  {formatCurrency(comparisonMetrics[strategy].endingWealth)}
                </TableCell>
              ))}
            </TableRow>

            {/* Lifetime Tax Savings Row */}
            <TableRow>
              <TableCell className="font-medium">Tax Savings</TableCell>
              {STRATEGIES.map(strategy => (
                <TableCell
                  key={strategy}
                  className={cn(
                    'text-center font-mono text-sm',
                    strategy === bestStrategy && 'bg-primary/10',
                    comparisonMetrics[strategy].taxSavings > 0 && 'text-green-600'
                  )}
                >
                  {formatSavings(comparisonMetrics[strategy].taxSavings)}
                </TableCell>
              ))}
            </TableRow>

            {/* Breakeven Age Row */}
            <TableRow>
              <TableCell className="font-medium">Breakeven Age</TableCell>
              {STRATEGIES.map(strategy => (
                <TableCell
                  key={strategy}
                  className={cn(
                    'text-center text-sm',
                    strategy === bestStrategy && 'bg-primary/10'
                  )}
                >
                  {comparisonMetrics[strategy].breakEvenAge ?? 'N/A'}
                </TableCell>
              ))}
            </TableRow>

            {/* IRMAA Surcharges Row */}
            <TableRow>
              <TableCell className="font-medium">IRMAA Surcharges</TableCell>
              {STRATEGIES.map(strategy => (
                <TableCell
                  key={strategy}
                  className={cn(
                    'text-center font-mono text-sm',
                    strategy === bestStrategy && 'bg-primary/10',
                    comparisonMetrics[strategy].totalIRMAA > 0 && 'text-amber-600'
                  )}
                >
                  {comparisonMetrics[strategy].totalIRMAA === 0
                    ? '$0'
                    : formatCurrency(comparisonMetrics[strategy].totalIRMAA)
                  }
                </TableCell>
              ))}
            </TableRow>

            {/* Heir Benefit Row */}
            <TableRow>
              <TableCell className="font-medium">Heir Benefit</TableCell>
              {STRATEGIES.map(strategy => (
                <TableCell
                  key={strategy}
                  className={cn(
                    'text-center font-mono text-sm',
                    strategy === bestStrategy && 'bg-primary/10',
                    comparisonMetrics[strategy].heirBenefit > 0 && 'text-green-600'
                  )}
                >
                  {formatSavings(comparisonMetrics[strategy].heirBenefit)}
                </TableCell>
              ))}
            </TableRow>
          </TableBody>
        </Table>
      </div>

      {/* Strategy Selection Row */}
      {onStrategySelect && (
        <div className="grid grid-cols-5 gap-2 p-4 border-t bg-muted/30">
          <div className="flex items-center text-sm font-medium text-muted-foreground">
            View Details
          </div>
          {STRATEGIES.map(strategy => (
            <Button
              key={strategy}
              variant={selectedStrategy === strategy ? 'default' : 'outline'}
              size="sm"
              onClick={() => onStrategySelect(strategy)}
              className={cn(
                'w-full',
                strategy === bestStrategy && selectedStrategy !== strategy &&
                  'border-primary/50'
              )}
            >
              {selectedStrategy === strategy ? 'Selected' : 'Select'}
            </Button>
          ))}
        </div>
      )}
    </div>
  );
}
```

Key implementation notes:
- Uses shadcn/ui Table components
- bg-primary/10 for best strategy column highlight
- Horizontal scroll with min-width for mobile responsiveness
- formatCurrency handles cents-to-dollars conversion
- Green text for positive savings, amber for IRMAA costs
- Optional onStrategySelect callback for detail view integration
- Selected strategy button shows "Selected" state
  </action>
  <verify>
Run `npx tsc --noEmit` - should compile.
Check file exists: `ls components/results/strategy-comparison/strategy-comparison-table.tsx`
Check imports: `grep "STRATEGY_DEFINITIONS" components/results/strategy-comparison/strategy-comparison-table.tsx`
  </verify>
  <done>
StrategyComparisonTable created. Shows 5 metrics for 4 strategies with best highlighted and selection buttons.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create barrel exports</name>
  <files>
    components/results/strategy-comparison/index.ts
    components/results/index.ts
  </files>
  <action>
Create `components/results/strategy-comparison/index.ts`:

```typescript
export { BestBadge } from './best-badge';
export { StrategyComparisonTable } from './strategy-comparison-table';
```

Update `components/results/index.ts` to include strategy comparison exports. Add this line:

```typescript
// Strategy Comparison (Phase 06)
export { BestBadge, StrategyComparisonTable } from './strategy-comparison';
```

This should be added after the existing exports (StatCard, ChartTooltip, WealthChart, SummarySection, ResultsSummary from Phase 05).

Key implementation notes:
- Barrel export pattern for clean imports
- Consumers can import from '@/components/results' or '@/components/results/strategy-comparison'
  </action>
  <verify>
Check strategy-comparison index: `cat components/results/strategy-comparison/index.ts`
Check main results index has export: `grep "StrategyComparisonTable" components/results/index.ts`
Run `npx tsc --noEmit` - should compile.
  </verify>
  <done>
Barrel exports created. StrategyComparisonTable and BestBadge accessible from components/results.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npx tsc --noEmit` passes with no errors
2. BestBadge displays green badge with star icon
3. StrategyComparisonTable renders 5 rows x 4 strategy columns
4. Best strategy column has bg-primary/10 background
5. View Details buttons call onStrategySelect callback
6. Components accessible from '@/components/results'
</verification>

<success_criteria>
- BestBadge uses Star icon from lucide-react with fill-current
- Table header shows strategy name, description, and BEST badge for winner
- 5 metric rows: Ending Wealth, Tax Savings, Breakeven Age, IRMAA Surcharges, Heir Benefit
- Currency values formatted with Intl.NumberFormat (cents to dollars)
- Positive savings show green text, IRMAA costs show amber
- Horizontal scroll works on mobile with sticky metric column
- Selection buttons toggle between "Select" and "Selected" states
</success_criteria>

<output>
After completion, create `.planning/phases/06-multi-strategy-comparison/06-02-SUMMARY.md`
</output>

---
phase: 03-client-data-entry-form
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - lib/data/states.ts
  - lib/data/federal-brackets.ts
  - components/ui/currency-input.tsx
  - components/ui/percent-input.tsx
  - components/clients/form-section.tsx
autonomous: true

must_haves:
  truths:
    - "CurrencyInput displays dollar sign prefix and formats with commas"
    - "PercentInput displays percent suffix and accepts decimals"
    - "State data provides 50 states with tax type and top rate"
    - "FormSection renders title and optional description with children grid"
  artifacts:
    - path: "lib/data/states.ts"
      provides: "US states with tax rates"
      exports: ["US_STATES", "StateInfo", "getStateByCode", "getDefaultStateTaxRate"]
    - path: "lib/data/federal-brackets.ts"
      provides: "Federal tax bracket options"
      exports: ["FEDERAL_BRACKETS", "FederalBracket"]
    - path: "components/ui/currency-input.tsx"
      provides: "Currency input with dollar formatting"
      exports: ["CurrencyInput"]
    - path: "components/ui/percent-input.tsx"
      provides: "Percent input with suffix"
      exports: ["PercentInput"]
    - path: "components/clients/form-section.tsx"
      provides: "Section header component"
      exports: ["FormSection"]
  key_links:
    - from: "components/ui/currency-input.tsx"
      to: "react-currency-input-field"
      via: "import CurrencyInputField"
      pattern: "from.*react-currency-input-field"
    - from: "components/ui/currency-input.tsx"
      to: "components/ui/input-group.tsx"
      via: "InputGroup composition"
      pattern: "InputGroup.*InputGroupAddon"
---

<objective>
Create foundational components and data modules for the 28-field client form.

Purpose: Provide reusable currency/percent inputs, US state tax data, and section layout components that all form sections will use.

Output: Custom input components, state tax data module, federal bracket data, and FormSection component ready for section composition.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-client-data-entry-form/03-RESEARCH.md
@components/ui/input-group.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-currency-input-field and create data modules</name>
  <files>
    - package.json
    - lib/data/states.ts
    - lib/data/federal-brackets.ts
  </files>
  <action>
1. Install the currency input library:
   ```bash
   npm install react-currency-input-field
   ```

2. Create `lib/data/states.ts` with US state tax data:
   - Export `StateInfo` interface with: code, name, taxType ("none" | "flat" | "progressive"), topRate (number as percentage e.g., 13.30 for California)
   - Export `US_STATES` array with all 50 states + DC
   - Include 8 no-income-tax states: AK, FL, NV, NH, SD, TN, TX, WY
   - Include flat tax states: AZ (2.5%), CO (4.4%), GA (5.39%), ID (5.695%), IL (4.95%), IN (3.0%), IA (3.8%), KY (4.0%), LA (3.0%), MI (4.25%), MS (4.4%), NC (4.25%), PA (3.07%), UT (4.55%)
   - Include progressive states with top rates (see 03-RESEARCH.md for full list)
   - Export `getStateByCode(code: string): StateInfo | undefined`
   - Export `getDefaultStateTaxRate(code: string): number` - returns topRate or 0

3. Create `lib/data/federal-brackets.ts`:
   - Export `FederalBracket` interface with: value (string), label (string), rate (number)
   - Export `FEDERAL_BRACKETS` array:
     - { value: "auto", label: "Auto-detect", rate: 0 }
     - { value: "10", label: "10%", rate: 10 }
     - { value: "12", label: "12%", rate: 12 }
     - { value: "22", label: "22%", rate: 22 }
     - { value: "24", label: "24%", rate: 24 }
     - { value: "32", label: "32%", rate: 32 }
     - { value: "35", label: "35%", rate: 35 }
     - { value: "37", label: "37%", rate: 37 }
  </action>
  <verify>
    - `npm ls react-currency-input-field` shows package installed
    - `npx tsc --noEmit` passes (no type errors in data modules)
  </verify>
  <done>
    - react-currency-input-field installed
    - US_STATES array has 51 entries (50 states + DC)
    - getDefaultStateTaxRate("CA") returns 13.3
    - getDefaultStateTaxRate("TX") returns 0
    - FEDERAL_BRACKETS has 8 entries including "auto"
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CurrencyInput and PercentInput components</name>
  <files>
    - components/ui/currency-input.tsx
    - components/ui/percent-input.tsx
  </files>
  <action>
1. Create `components/ui/currency-input.tsx`:
   - "use client" directive (uses event handlers)
   - Import CurrencyInputField from react-currency-input-field
   - Import InputGroup, InputGroupAddon, InputGroupInput from @/components/ui/input-group
   - Interface CurrencyInputProps:
     - value: number | undefined (value in CENTS)
     - onChange: (cents: number | undefined) => void
     - placeholder?: string (default "0")
     - disabled?: boolean
     - className?: string
     - "aria-invalid"?: boolean
   - Use forwardRef to forward ref to input
   - Convert cents to dollars for display: `value !== undefined ? (value / 100).toString() : ""`
   - On value change, convert dollars to cents: `Math.round(values.float * 100)`
   - Compose with InputGroup:
     ```tsx
     <InputGroup className={cn("w-full", className)}>
       <InputGroupAddon align="inline-start">$</InputGroupAddon>
       <CurrencyInputField
         customInput={InputGroupInput}
         value={displayValue}
         decimalsLimit={2}
         decimalScale={2}
         groupSeparator=","
         decimalSeparator="."
         placeholder={placeholder}
         disabled={disabled}
         onValueChange={(_, __, values) => {
           if (values?.float !== undefined && values.float !== null) {
             onChange(Math.round(values.float * 100));
           } else {
             onChange(undefined);
           }
         }}
         aria-invalid={props["aria-invalid"]}
       />
     </InputGroup>
     ```
   - Set displayName = "CurrencyInput"

2. Create `components/ui/percent-input.tsx`:
   - Similar structure but:
     - value is number (percentage, e.g., 6 for 6%), NOT cents
     - No conversion needed
     - Addon on inline-end with "%"
     - decimalsLimit: 2, decimalScale: 1
     - groupSeparator: "" (no thousands separator for percentages)
   - Set displayName = "PercentInput"
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Both components export properly: check imports resolve
  </verify>
  <done>
    - CurrencyInput accepts cents, displays dollars with $ prefix
    - PercentInput accepts percentage number, displays with % suffix
    - Both integrate with InputGroup styling
    - Both support aria-invalid for error states
  </done>
</task>

<task type="auto">
  <name>Task 3: Create FormSection component</name>
  <files>
    - components/clients/form-section.tsx
  </files>
  <action>
Create `components/clients/form-section.tsx`:
- Interface FormSectionProps:
  - title: string
  - description?: string
  - children: React.ReactNode
- Render:
  ```tsx
  <section className="space-y-4">
    <div className="border-b pb-2">
      <h3 className="text-lg font-semibold">{title}</h3>
      {description && (
        <p className="text-sm text-muted-foreground">{description}</p>
      )}
    </div>
    <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      {children}
    </div>
  </section>
  ```
- Export FormSection
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Component exports correctly
  </verify>
  <done>
    - FormSection renders title with border-b
    - Optional description renders in muted text
    - Children render in responsive 3-column grid
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` succeeds
2. All new files pass TypeScript checks
3. Imports work correctly between components
</verification>

<success_criteria>
- react-currency-input-field installed and working
- 51 US states with tax data available
- CurrencyInput and PercentInput render with proper formatting
- FormSection provides consistent section headers
- All components ready for use in form sections (Plan 02)
</success_criteria>

<output>
After completion, create `.planning/phases/03-client-data-entry-form/03-01-SUMMARY.md`
</output>

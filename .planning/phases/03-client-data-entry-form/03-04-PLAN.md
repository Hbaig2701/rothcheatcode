---
phase: 03-client-data-entry-form
plan: 04
type: execute
wave: 2
depends_on: [03-01, 03-02]
files_modified:
  - components/clients/sections/income-sources.tsx
  - components/clients/sections/conversion.tsx
  - components/clients/sections/advanced.tsx
autonomous: true

must_haves:
  truths:
    - "IncomeSources uses CurrencyInput for 4 income fields"
    - "IncomeSources has SS Start Age number input with 62-70 range"
    - "Conversion section has strategy radio group with 4 options"
    - "Advanced section has growth and inflation rate percent inputs"
  artifacts:
    - path: "components/clients/sections/income-sources.tsx"
      provides: "Income sources form section (5 fields)"
      exports: ["IncomeSourcesSection"]
    - path: "components/clients/sections/conversion.tsx"
      provides: "Conversion settings form section (4 fields)"
      exports: ["ConversionSection"]
    - path: "components/clients/sections/advanced.tsx"
      provides: "Advanced options form section (5 fields)"
      exports: ["AdvancedSection"]
  key_links:
    - from: "components/clients/sections/income-sources.tsx"
      to: "components/ui/currency-input.tsx"
      via: "Controller + CurrencyInput"
      pattern: "Controller.*CurrencyInput"
    - from: "components/clients/sections/advanced.tsx"
      to: "components/ui/percent-input.tsx"
      via: "Controller + PercentInput"
      pattern: "Controller.*PercentInput"
---

<objective>
Create the remaining three form sections: Income Sources, Conversion Settings, and Advanced Options.

Purpose: Complete the second half of the 28-field form covering income, conversion strategy, and advanced modeling options.

Output: Three form section components completing all 28 fields for the client data entry form.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/03-client-data-entry-form/03-RESEARCH.md
@.planning/phases/03-client-data-entry-form/03-01-SUMMARY.md
@.planning/phases/03-client-data-entry-form/03-02-SUMMARY.md
@components/clients/form-section.tsx
@components/ui/currency-input.tsx
@components/ui/percent-input.tsx
@lib/validations/client.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create IncomeSourcesSection component</name>
  <files>
    - components/clients/sections/income-sources.tsx
  </files>
  <action>
Create `components/clients/sections/income-sources.tsx`:

```typescript
"use client";

import { Controller, useFormContext } from "react-hook-form";
import type { ClientFullFormData } from "@/lib/validations/client";
import { FormSection } from "@/components/clients/form-section";
import { Field, FieldLabel, FieldError, FieldDescription } from "@/components/ui/field";
import { CurrencyInput } from "@/components/ui/currency-input";
import { Input } from "@/components/ui/input";
```

Fields (FormSection title: "Income Sources", description: "Annual amounts in today's dollars"):

1. **Social Security (Self)** - CurrencyInput, Controller, description: "Your annual SS benefit"
2. **Social Security (Spouse)** - CurrencyInput, Controller, description: "Spouse's annual SS benefit"
3. **Pension** - CurrencyInput, Controller, description: "Annual pension income"
4. **Other Income** - CurrencyInput, Controller, description: "Rental, part-time work, etc."
5. **SS Start Age** - number Input, range 62-70, default 67
   ```tsx
   <Input
     id="ss_start_age"
     type="number"
     min={62}
     max={70}
     {...form.register("ss_start_age", { valueAsNumber: true })}
   />
   ```

Use same Controller pattern as AccountBalancesSection for currency fields.

Export as `IncomeSourcesSection`.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Component exports correctly
  </verify>
  <done>
    - IncomeSourcesSection renders 5 fields
    - 4 currency fields use CurrencyInput
    - SS Start Age is number input with 62-70 range
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ConversionSection component</name>
  <files>
    - components/clients/sections/conversion.tsx
  </files>
  <action>
Create `components/clients/sections/conversion.tsx`:

```typescript
"use client";

import { Controller, useFormContext } from "react-hook-form";
import type { ClientFullFormData } from "@/lib/validations/client";
import { FormSection } from "@/components/clients/form-section";
import { Field, FieldLabel, FieldError, FieldDescription } from "@/components/ui/field";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
```

Fields (FormSection title: "Conversion Settings"):

1. **Strategy** - Radio group with 4 options:
   - conservative: "Conservative - Stay in lowest bracket"
   - moderate: "Moderate - Fill 22%/24% bracket"
   - aggressive: "Aggressive - Fill 32% bracket"
   - irmaa_safe: "IRMAA-Safe - Avoid Medicare surcharges"

   Implementation with native radio inputs (styled with Tailwind):
   ```tsx
   <Controller
     name="strategy"
     control={form.control}
     render={({ field, fieldState }) => (
       <Field data-invalid={fieldState.invalid}>
         <FieldLabel>Conversion Strategy</FieldLabel>
         <div className="space-y-2">
           {[
             { value: "conservative", label: "Conservative - Stay in lowest bracket" },
             { value: "moderate", label: "Moderate - Fill 22%/24% bracket" },
             { value: "aggressive", label: "Aggressive - Fill 32% bracket" },
             { value: "irmaa_safe", label: "IRMAA-Safe - Avoid Medicare surcharges" },
           ].map((option) => (
             <label key={option.value} className="flex items-center gap-2 cursor-pointer">
               <input
                 type="radio"
                 value={option.value}
                 checked={field.value === option.value}
                 onChange={(e) => field.onChange(e.target.value)}
                 className="h-4 w-4 text-primary"
               />
               <span className="text-sm">{option.label}</span>
             </label>
           ))}
         </div>
         <FieldError errors={[fieldState.error]} />
       </Field>
     )}
   />
   ```

2. **Start Age** - number Input, register with valueAsNumber
3. **End Age** - number Input, register with valueAsNumber, description: "When to stop conversions"
4. **Tax Payment Source** - Radio group with 2 options:
   - from_taxable: "Pay from taxable accounts"
   - from_ira: "Pay from IRA (reduces conversion amount)"

Export as `ConversionSection`.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Radio groups work correctly with Controller
  </verify>
  <done>
    - ConversionSection renders 4 fields
    - Strategy radio shows 4 options with descriptions
    - Tax payment source radio shows 2 options
    - Age inputs use number type with valueAsNumber
  </done>
</task>

<task type="auto">
  <name>Task 3: Create AdvancedSection component</name>
  <files>
    - components/clients/sections/advanced.tsx
  </files>
  <action>
Create `components/clients/sections/advanced.tsx`:

```typescript
"use client";

import { Controller, useFormContext } from "react-hook-form";
import type { ClientFullFormData } from "@/lib/validations/client";
import { FormSection } from "@/components/clients/form-section";
import { Field, FieldLabel, FieldError, FieldDescription } from "@/components/ui/field";
import { PercentInput } from "@/components/ui/percent-input";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { FEDERAL_BRACKETS } from "@/lib/data/federal-brackets";
```

Fields (FormSection title: "Advanced Options", description: "Adjust projection assumptions"):

1. **Growth Rate** - PercentInput, Controller, default 6%
2. **Inflation Rate** - PercentInput, Controller, default 2.5%
3. **Heir Tax Bracket** - Select with federal brackets (exclude "auto"), description: "Bracket for inherited IRA taxation"
4. **Projection Years** - number Input, default 40, range 10-60
5. **Widow Analysis** - Checkbox, description: "Include single-filer impact analysis"

For PercentInput with Controller:
```tsx
<Controller
  name="growth_rate"
  control={form.control}
  render={({ field: { ref, ...field }, fieldState }) => (
    <Field data-invalid={fieldState.invalid}>
      <FieldLabel htmlFor="growth_rate">Growth Rate</FieldLabel>
      <PercentInput
        {...field}
        aria-invalid={fieldState.invalid}
      />
      <FieldDescription>Expected annual investment return</FieldDescription>
      <FieldError errors={[fieldState.error]} />
    </Field>
  )}
/>
```

For heir bracket Select, filter out the "auto" option from FEDERAL_BRACKETS.

Export as `AdvancedSection`.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - PercentInput displays % suffix
  </verify>
  <done>
    - AdvancedSection renders 5 fields
    - Growth and inflation use PercentInput with % suffix
    - Heir bracket dropdown excludes "auto" option
    - Widow analysis checkbox works correctly
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` succeeds
2. All 6 sections together cover all 28 fields
3. Each section uses useFormContext correctly
</verification>

<success_criteria>
- IncomeSourcesSection has 4 currency inputs + 1 number input
- ConversionSection has 2 radio groups + 2 number inputs
- AdvancedSection has 2 percent inputs + 1 select + 1 number + 1 checkbox
- All sections use FormSection wrapper
- All custom inputs (CurrencyInput, PercentInput) work with Controller
</success_criteria>

<output>
After completion, create `.planning/phases/03-client-data-entry-form/03-04-SUMMARY.md`
</output>

---
phase: 03-client-data-entry-form
plan: 07
type: execute
wave: 4
depends_on: [03-05, 03-06]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Form renders all 28 fields across 6 sections"
    - "Validation errors display inline for invalid fields"
    - "Smart defaults populate when DOB is entered"
    - "Form submits and saves to database"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete 28-field client form works end-to-end.

Purpose: Ensure all form sections, validation, smart defaults, and database persistence work correctly before completing the phase.

Output: Verified working form with user approval.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/03-client-data-entry-form/03-05-SUMMARY.md
@.planning/phases/03-client-data-entry-form/03-06-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run migration and verify database</name>
  <files></files>
  <action>
1. Apply the migration to the local Supabase instance:
   ```bash
   npx supabase db push
   ```
   Or if using Supabase CLI:
   ```bash
   supabase migration up
   ```

2. Verify the clients table has all 28 columns by checking the schema.

3. If there are existing client records, verify they have default values applied.

Note: If Supabase is not set up locally, this step may need to be run against the remote database or skipped for local development.
  </action>
  <verify>
    - Migration applies without errors
    - `SELECT * FROM clients LIMIT 1` shows all columns
  </verify>
  <done>
    - Database schema updated with all 28 client fields
    - Existing records have default values
  </done>
</task>

<task type="auto">
  <name>Task 2: Build and start dev server</name>
  <files></files>
  <action>
1. Run TypeScript check:
   ```bash
   npx tsc --noEmit
   ```

2. Run build to catch any issues:
   ```bash
   npm run build
   ```

3. Start dev server:
   ```bash
   npm run dev
   ```

4. Note the local URL (typically http://localhost:3000)
  </action>
  <verify>
    - Build succeeds without errors
    - Dev server starts successfully
  </verify>
  <done>
    - Application builds and runs
    - Ready for manual testing
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete 28-field client data entry form with:
- 6 organized sections (Personal, Accounts, Tax, Income, Conversion, Advanced)
- Currency inputs with dollar formatting
- Percent inputs with percentage formatting
- Smart defaults (life expectancy, start age from DOB)
- Conditional fields (spouse DOB when married)
- Auto-fill state tax rate
- Full Zod validation
  </what-built>
  <how-to-verify>
1. Navigate to http://localhost:3000/clients/new

2. **Verify Section Layout:**
   - [ ] Personal Information section visible with 6 fields
   - [ ] Account Balances section with 4 currency fields
   - [ ] Tax Configuration section with 4 fields
   - [ ] Income Sources section with 5 fields
   - [ ] Conversion Settings section with 4 fields
   - [ ] Advanced Options section with 5 fields

3. **Test Smart Defaults:**
   - [ ] Enter a DOB (e.g., 1960-05-15)
   - [ ] Life expectancy field should auto-populate
   - [ ] Start age should update to current age (or minimum 50)

4. **Test Conditional Fields:**
   - [ ] Select "Single" filing status - spouse DOB should hide
   - [ ] Select "Married Filing Jointly" - spouse DOB should appear

5. **Test Currency Inputs:**
   - [ ] Type "500000" in Traditional IRA - should display "$500,000.00"
   - [ ] Delete and type "1234567.89" - should format correctly

6. **Test State Tax Auto-fill:**
   - [ ] Select "CA" as state - state tax rate should show ~13.3%
   - [ ] Select "TX" as state - state tax rate should show 0%

7. **Test Validation:**
   - [ ] Try to submit with empty required fields - errors should appear
   - [ ] Enter valid data and submit - should redirect to /clients

8. **Test Edit Mode (if client exists):**
   - [ ] Navigate to an existing client's edit page
   - [ ] Verify all fields populate correctly
   - [ ] Make a change and save
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
Phase complete when:
1. All form sections render correctly
2. Smart defaults work
3. Validation prevents invalid submissions
4. Data persists to database
</verification>

<success_criteria>
- Complete 28-field form functional
- User has verified the form works correctly
- Phase 03 ready to mark complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-client-data-entry-form/03-07-SUMMARY.md`
</output>

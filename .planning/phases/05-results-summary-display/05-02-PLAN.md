---
phase: 05-results-summary-display
plan: 02
type: execute
wave: 2
depends_on: [05-01]
files_modified:
  - components/results/stat-card.tsx
  - components/results/chart-tooltip.tsx
  - components/results/wealth-chart.tsx
  - components/results/summary-section.tsx
  - components/results/index.ts
autonomous: true

must_haves:
  truths:
    - "StatCard displays animated count-up numbers with trend indicators"
    - "WealthChart renders two lines (gray baseline, blue blueprint) with breakeven marker"
    - "Chart tooltip shows formatted values for both scenarios"
    - "SummarySection displays 3 stat cards in responsive grid"
  artifacts:
    - path: "components/results/stat-card.tsx"
      provides: "Reusable stat card with count-up animation"
      min_lines: 40
    - path: "components/results/wealth-chart.tsx"
      provides: "Recharts line chart for wealth comparison"
      min_lines: 60
    - path: "components/results/chart-tooltip.tsx"
      provides: "Custom tooltip for chart hover"
      min_lines: 30
    - path: "components/results/summary-section.tsx"
      provides: "Grid of stat cards for summary metrics"
      min_lines: 30
    - path: "components/results/index.ts"
      provides: "Barrel export for results components"
      exports: ["StatCard", "WealthChart", "ChartTooltip", "SummarySection"]
  key_links:
    - from: "components/results/stat-card.tsx"
      to: "react-countup"
      via: "import CountUp"
      pattern: "import.*CountUp.*from.*react-countup"
    - from: "components/results/wealth-chart.tsx"
      to: "recharts"
      via: "import chart components"
      pattern: "import.*LineChart.*from.*recharts"
    - from: "components/results/summary-section.tsx"
      to: "components/results/stat-card.tsx"
      via: "import StatCard"
      pattern: "import.*StatCard"
---

<objective>
Create all display components for the results summary page.

Purpose: Build the visual layer that presents projection data as animated stat cards and a wealth divergence chart with the "wow moment" visualization.
Output: StatCard with count-up, WealthChart with dual lines and breakeven marker, ChartTooltip, and SummarySection grid.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-results-summary-display/05-RESEARCH.md
@.planning/phases/05-results-summary-display/05-01-SUMMARY.md

@lib/calculations/transforms.ts
@components/ui/card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StatCard component with count-up animation</name>
  <files>components/results/stat-card.tsx</files>
  <action>
Create `components/results/stat-card.tsx` - a reusable card showing a metric with animated number.

```typescript
'use client';

import CountUp from 'react-countup';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { TrendingUp, TrendingDown, Minus } from 'lucide-react';
import { cn } from '@/lib/utils';

interface StatCardProps {
  title: string;
  value: number;        // In cents
  prefix?: string;      // e.g., '$'
  suffix?: string;      // e.g., '%'
  decimals?: number;
  trend?: 'up' | 'down' | 'neutral';
  trendLabel?: string;  // e.g., "+$45,000 vs Baseline"
  className?: string;
  highlight?: boolean;  // Add border emphasis
}

export function StatCard({
  title,
  value,
  prefix = '$',
  suffix = '',
  decimals = 0,
  trend,
  trendLabel,
  className,
  highlight = false,
}: StatCardProps) {
  // Convert cents to dollars for display
  const displayValue = value / 100;

  const TrendIcon = trend === 'up' ? TrendingUp
                  : trend === 'down' ? TrendingDown
                  : Minus;

  const trendColor = trend === 'up' ? 'text-green-600'
                   : trend === 'down' ? 'text-red-600'
                   : 'text-muted-foreground';

  return (
    <Card className={cn(
      '',
      highlight && 'border-blue-500 border-2',
      className
    )}>
      <CardHeader className="pb-2">
        <CardTitle className="text-sm font-medium text-muted-foreground">
          {title}
        </CardTitle>
      </CardHeader>
      <CardContent>
        <div className="text-2xl font-bold">
          <CountUp
            start={0}
            end={displayValue}
            duration={2}
            decimals={decimals}
            prefix={prefix}
            suffix={suffix}
            separator=","
            useEasing={true}
            enableScrollSpy={false}  // Trigger immediately on mount
          />
        </div>
        {trend && trendLabel && (
          <div className={cn('flex items-center gap-1 mt-1 text-sm', trendColor)}>
            <TrendIcon className="h-4 w-4" />
            <span>{trendLabel}</span>
          </div>
        )}
      </CardContent>
    </Card>
  );
}
```

Key implementation notes:
- `'use client'` required - react-countup uses browser APIs
- Value is in cents, converted to dollars (`value / 100`)
- `enableScrollSpy={false}` - trigger animation on mount, not scroll into view
- `highlight` prop for the Blueprint card (emphasized with blue border)
- TrendIcon selected dynamically based on trend prop
- Color coding: green for up, red for down, muted for neutral
  </action>
  <verify>
Run `npx tsc --noEmit` - should compile without errors.
Check component exports correctly: `grep "export function StatCard" components/results/stat-card.tsx`
  </verify>
  <done>
StatCard component renders with count-up animation, trend indicator, and optional highlight.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ChartTooltip and WealthChart components</name>
  <files>
    components/results/chart-tooltip.tsx
    components/results/wealth-chart.tsx
  </files>
  <action>
Create `components/results/chart-tooltip.tsx`:

```typescript
'use client';

import { type TooltipProps } from 'recharts';
import { type NameType, type ValueType } from 'recharts/types/component/DefaultTooltipContent';
import { formatCurrency } from '@/lib/calculations/transforms';
import { cn } from '@/lib/utils';

export function ChartTooltip({
  active,
  payload,
  label,
}: TooltipProps<ValueType, NameType>) {
  if (!active || !payload || !payload.length) {
    return null;
  }

  const baseline = payload.find(p => p.dataKey === 'baseline');
  const blueprint = payload.find(p => p.dataKey === 'blueprint');
  const difference = blueprint && baseline
    ? (blueprint.value as number) - (baseline.value as number)
    : 0;

  return (
    <div className="rounded-lg border bg-background p-3 shadow-lg">
      <p className="font-medium mb-2">Age {label}</p>
      <div className="space-y-1 text-sm">
        <div className="flex justify-between gap-4">
          <span className="text-gray-500">Baseline:</span>
          <span className="font-mono">{formatCurrency(baseline?.value as number ?? 0)}</span>
        </div>
        <div className="flex justify-between gap-4">
          <span className="text-blue-600">Blueprint:</span>
          <span className="font-mono">{formatCurrency(blueprint?.value as number ?? 0)}</span>
        </div>
        <div className="border-t pt-1 mt-1">
          <div className="flex justify-between gap-4">
            <span className="text-green-600">Difference:</span>
            <span className={cn(
              'font-mono font-medium',
              difference >= 0 ? 'text-green-600' : 'text-red-600'
            )}>
              {difference >= 0 ? '+' : ''}{formatCurrency(difference)}
            </span>
          </div>
        </div>
      </div>
    </div>
  );
}
```

Create `components/results/wealth-chart.tsx`:

```typescript
'use client';

import {
  LineChart,
  Line,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
  ReferenceLine,
} from 'recharts';
import { ChartTooltip } from './chart-tooltip';
import { type ChartDataPoint, formatAxisValue } from '@/lib/calculations/transforms';

interface WealthChartProps {
  data: ChartDataPoint[];
  breakEvenAge: number | null;
}

export function WealthChart({ data, breakEvenAge }: WealthChartProps) {
  return (
    <div className="h-[400px] w-full">
      {/* CRITICAL: Parent div MUST have explicit height for ResponsiveContainer */}
      <ResponsiveContainer width="100%" height="100%">
        <LineChart
          data={data}
          margin={{ top: 20, right: 30, left: 20, bottom: 5 }}
        >
          <CartesianGrid strokeDasharray="3 3" className="stroke-muted" />
          <XAxis
            dataKey="age"
            label={{ value: 'Age', position: 'insideBottom', offset: -5 }}
            tick={{ fontSize: 12 }}
          />
          <YAxis
            tickFormatter={formatAxisValue}
            width={70}
            tick={{ fontSize: 12 }}
          />
          <Tooltip content={<ChartTooltip />} />
          <Legend
            verticalAlign="top"
            height={36}
          />
          {/* Baseline line - gray */}
          <Line
            type="monotone"
            dataKey="baseline"
            name="Baseline (No Conversion)"
            stroke="#6b7280"  // gray-500
            strokeWidth={2}
            dot={false}
            activeDot={{ r: 6 }}
            isAnimationActive={true}
            animationDuration={1500}
            animationEasing="ease-out"
          />
          {/* Blueprint line - blue (theme color) */}
          <Line
            type="monotone"
            dataKey="blueprint"
            name="Blueprint (Roth Conversion)"
            stroke="#3b82f6"  // blue-500
            strokeWidth={2}
            dot={false}
            activeDot={{ r: 6 }}
            isAnimationActive={true}
            animationDuration={1500}
            animationEasing="ease-out"
          />
          {/* Breakeven marker - green dashed vertical line */}
          {breakEvenAge && (
            <ReferenceLine
              x={breakEvenAge}
              stroke="#22c55e"  // green-500
              strokeDasharray="5 5"
              strokeWidth={2}
              label={{
                value: `Breakeven: Age ${breakEvenAge}`,
                position: 'top',
                fill: '#22c55e',
                fontSize: 12,
                fontWeight: 500,
              }}
            />
          )}
        </LineChart>
      </ResponsiveContainer>
    </div>
  );
}
```

Key implementation notes:
- Both components have `'use client'` - Recharts uses browser APIs
- WealthChart parent div has `h-[400px]` - CRITICAL for ResponsiveContainer
- Gray baseline (#6b7280), blue blueprint (#3b82f6) per design spec
- Breakeven line is green (#22c55e) dashed vertical
- Animation: 1.5s ease-out for smooth entry
- Custom tooltip shows formatted currency with difference calculation
- YAxis uses formatAxisValue for K/M abbreviations
  </action>
  <verify>
Run `npx tsc --noEmit` - should compile without errors.
Check both files exist and export correctly.
  </verify>
  <done>
ChartTooltip shows formatted values with difference. WealthChart renders dual lines with breakeven marker.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create SummarySection and barrel export</name>
  <files>
    components/results/summary-section.tsx
    components/results/index.ts
  </files>
  <action>
Create `components/results/summary-section.tsx`:

```typescript
'use client';

import { StatCard } from './stat-card';
import { type SummaryMetrics, formatCurrency } from '@/lib/calculations/transforms';

interface SummarySectionProps {
  metrics: SummaryMetrics;
}

export function SummarySection({ metrics }: SummarySectionProps) {
  const differenceFormatted = formatCurrency(Math.abs(metrics.difference));
  const differenceSign = metrics.difference >= 0 ? '+' : '-';

  return (
    <div className="grid gap-4 md:grid-cols-3">
      {/* Baseline card - no highlight */}
      <StatCard
        title="Baseline Ending Wealth"
        value={metrics.baselineEndWealth}
        prefix="$"
        className="border-gray-300"
      />

      {/* Blueprint card - highlighted with blue border */}
      <StatCard
        title="Blueprint Ending Wealth"
        value={metrics.blueprintEndWealth}
        prefix="$"
        trend={metrics.difference >= 0 ? 'up' : 'down'}
        trendLabel={`${differenceSign}${differenceFormatted} vs Baseline`}
        highlight={true}
      />

      {/* Tax Savings card */}
      <StatCard
        title="Total Lifetime Tax Savings"
        value={metrics.totalTaxSavings}
        prefix="$"
        trend={metrics.totalTaxSavings > 0 ? 'up' : 'neutral'}
        trendLabel={metrics.breakEvenAge
          ? `Breakeven at age ${metrics.breakEvenAge}`
          : 'No breakeven in projection'}
      />
    </div>
  );
}
```

Create `components/results/index.ts` barrel export:

```typescript
export { StatCard } from './stat-card';
export { ChartTooltip } from './chart-tooltip';
export { WealthChart } from './wealth-chart';
export { SummarySection } from './summary-section';
```

Key implementation notes:
- SummarySection uses 3-column responsive grid (`md:grid-cols-3`)
- Blueprint card has `highlight={true}` for blue border emphasis
- Tax Savings shows breakeven age if available
- Barrel export enables `import { StatCard, WealthChart } from '@/components/results'`
  </action>
  <verify>
Run `npx tsc --noEmit` - should compile without errors.
Check barrel export: `grep "export" components/results/index.ts` shows all 4 components.
  </verify>
  <done>
SummarySection renders 3-card grid. Barrel export provides clean imports for all components.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npx tsc --noEmit` passes with no errors
2. All 5 files exist in components/results/
3. StatCard animates from 0 to value over 2 seconds
4. WealthChart shows two lines with legend
5. ChartTooltip displays formatted baseline, blueprint, and difference
6. SummarySection renders responsive 3-column grid
7. Barrel export allows: `import { StatCard, WealthChart, SummarySection } from '@/components/results'`
</verification>

<success_criteria>
- StatCard uses react-countup with cents-to-dollars conversion
- WealthChart has explicit parent height (400px) for ResponsiveContainer
- All chart components have 'use client' directive
- Baseline is gray (#6b7280), Blueprint is blue (#3b82f6)
- Breakeven ReferenceLine appears when breakEvenAge is not null
- SummarySection displays 3 cards with Blueprint highlighted
</success_criteria>

<output>
After completion, create `.planning/phases/05-results-summary-display/05-02-SUMMARY.md`
</output>
